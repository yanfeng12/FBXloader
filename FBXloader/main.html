<!DOCTYPE html>
<html lang="en">
	<head>
		<title>three.js webgl - OBJLoader + MTLLoader</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<style>
			body {
				font-family: Monospace;
				background-color: #000;
				color: #fff;
				margin: 0px;
				overflow: hidden;
			}

			#info {
				color: #fff;
				position: absolute;
				top: 10px;
				width: 100%;
				text-align: center;
				z-index: 100;
				display: block;
			}

			#info a,
			.button {
				color: #f00;
				font-weight: bold;
				text-decoration: underline;
				cursor: pointer
			}
			#video{
				width: 100%;
				height: 100%;
			}
		</style>
	</head>

	<body>
		<!-- 		<div id="info">
		<a href="http://threejs.org" target="_blank" rel="noopener">three.js</a> - OBJLoader + MTLLoader
		</div> -->
		<video id="video" playsinline=""></video>
		<script src="libs/three/three.min.js"></script>

		<script src="js/loaders/DDSLoader.js"></script>
		<script src="js/loaders/MTLLoader.js"></script>
		<script src="js/loaders/OBJLoader.js"></script>

		<script src="js/Detector.js"></script>
		<script src="js/stats.min.js"></script>

		<!-- <script src="js/webar.js" type="text/javascript" charset="utf-8"></script> -->
		<script>
			var container, stats;
			var camera, scene, renderer;
			var mouseX = 0,
				mouseY = 0;
			var windowHalfX = window.innerWidth / 2;
			var windowHalfY = window.innerHeight / 2;

			var video = document.getElementById('video');
			var capture = document.getElementById('capture');
			var constraints = {
				audio: false,
				video: true,
			};
            getUserMediaTo(constraints,success,error);
			function getUserMediaTo(constraints, success, error) {
				if (navigator.mediaDevices.getUserMedia) {
					//最新标准API
					navigator.mediaDevices.getUserMedia(constraints).then(success).catch(error);
					console.log("success");
				} else if (navigator.webkitGetUserMedia) {
					//webkit核心浏览器
					navigator.webkitGetUserMedia(constraints, success, error);
				} else if (navigator.mozGetUserMedia) {
					//firefox浏览器
					navigator.mozGetUserMedia(constraints, success, error);
				} else if (navigator.getUserMedia) {
					//旧版API
					navigator.getUserMedia(constraints, success, error);
				}
			}
			//成功回调函数
			function success(stream) {
				//兼容webkit核心浏览器
				var CompatibleURL = window.URL || window.webkitURL;
				//将视频流转化为video的源
				video.src = CompatibleURL.createObjectURL(stream);
				video.play(); //播放视频
			}

			function error(error) {
				console.log('访问用户媒体失败：', error.name, error.message);
			}
			init();
			animate();

			function init() {
				// 				container = document.createElement( 'div' );
				// 				document.body.appendChild( container );






				camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 1, 2000);
				camera.position.z = 250;
				// scene
				scene = new THREE.Scene();
				var ambientLight = new THREE.AmbientLight(0xcccccc, 0.4);
				scene.add(ambientLight);
				var pointLight = new THREE.PointLight(0xffffff, 0.8);
				camera.add(pointLight);
				scene.add(camera);
				// model
				var onProgress = function(xhr) {
					if (xhr.lengthComputable) {
						var percentComplete = xhr.loaded / xhr.total * 100;
						console.log(Math.round(percentComplete, 2) + '% downloaded');
					}
				};
				var onError = function(xhr) {};
				THREE.Loader.Handlers.add(/\.dds$/i, new THREE.DDSLoader());
				new THREE.MTLLoader()
					.setPath('model/')
					.load('obj.mtl', function(materials) {
						materials.preload();
						new THREE.OBJLoader()
							.setMaterials(materials)
							.setPath('model/')
							.load('obj.obj', function(object) {
								object.position.y = -95;
								scene.add(object);
							}, onProgress, onError);
					});
				//
				renderer = new THREE.WebGLRenderer();
				renderer.setPixelRatio(window.devicePixelRatio);
				renderer.setSize(window.innerWidth, window.innerHeight);
				// container.appendChild(renderer.domElement);
				document.querySelector("#video").appendChild(renderer.domElement);
				document.addEventListener('mousemove', onDocumentMouseMove, false);
				//
				window.addEventListener('resize', onWindowResize, false);
			}

			function onWindowResize() {
				windowHalfX = window.innerWidth / 2;
				windowHalfY = window.innerHeight / 2;
				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();
				renderer.setSize(window.innerWidth, window.innerHeight);
			}

			function onDocumentMouseMove(event) {
				mouseX = (event.clientX - windowHalfX) / 2;
				mouseY = (event.clientY - windowHalfY) / 2;
			}
			//
			function animate() {
				requestAnimationFrame(animate);
				render();
			}

			function render() {
				camera.position.x += (mouseX - camera.position.x) * .05;
				camera.position.y += (-mouseY - camera.position.y) * .05;
				camera.lookAt(scene.position);
				renderer.render(scene, camera);
			}
		</script>

	</body>
</html>
